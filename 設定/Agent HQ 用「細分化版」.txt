了解です。
あなたが **Agent HQ（セッションごと管理）** を最大限活かせるよう、
ToDoリスト２を “セッションで1つずつ進められる粒度” にまで **完全に細分化** しました。

これをそのまま
**Agent Sessions → 新規セッション名にコピペして使える**
“セッション単位ToDo版” として作っています。

---

# 🔥 ToDoリスト２ ― Agent HQ 用「細分化版」

（＝そのまま1セッションとして切れるサイズに最適化）

---

# **セッション1：データパス & MT5履歴パイプラインの最終統一**

### 🎯 ゴール

PC3台（開発A / B / 運用VPS）で **同じコマンドでMT5履歴をCSV化** できる。

### 🔧 サブタスク

1. `fxbot_path.py` の現仕様を確認し、「root」「data」パス決定ロジックを文章化
2. `.env` or `setx` のどれを採用するか最終決定
3. `scripts/export_mt5_history.py` / `scripts/make_csv_from_mt5.py` / `scripts/mt5_export_csv.py` を比較
4. どれを“正式スクリプト”にするかを選定
5. スクリプト内部の

   * 出力パス
   * timeframe処理
   * root/data 統一
     の齟齬を徹底修正
6. 3台のPCで同じコマンドを実行 → 出力先にズレがないか確認
7. `README.md` に「データ更新手順」を明文化

---

# **セッション2：バックテスト CLI に期間指定オプション追加**

### 🎯 ゴール

`tools/backtest_run.py` を **--start-date / --end-date** 付きで動かせる。

### 🔧 サブタスク

1. `backtest_run.py` の現状コードを読み、データ読込〜実行の流れを把握
2. argparse を追加（--start-date, --end-date）
3. 日付フィルタリング処理を実装
4. 出力フォルダ命名を
   `backtest_YYYY-MM-DD_to_YYYY-MM-DD`
   の形式で拡張
5. 期間指定なしの場合「全期間」を保持するよう分岐実装
6. テスト：

   * 全期間
   * 半年だけ
   * 1ヶ月だけ
     でエクイティが変わることを確認

---

# **セッション3：GUI バックテストタブの期間指定と「ALL」ボタン連動**

### 🎯 ゴール

Backtestタブで日付指定してバックテスト → グラフ更新できる。

### 🔧 サブタスク

1. GUI内のBacktestタブ（`history_tab.py` または `backtest_tab.py`）の構造確認
2. From/To 日付ピッカーウィジェットを設置
3. ボタン押下時に CLI の backtest_run.py を呼ぶロジックを追加
4. 期間指定 → CLI実行 → CSV読込 → グラフ更新
5. 「ALLボタン」クリックで

   * 日付ピッカーを最初の範囲にリセット
   * グラフズームを全期間に戻す
6. エラー時の GUI 表示（メッセージボックス or ラベル）

---

# **セッション4：Backtest vs Walkforward 結果の切替＆重ね描画**

### 🎯 ゴール

Backtest結果・Walkforward結果を
**切替 or overlay（重ね描画）** できる。

### 🔧 サブタスク

1. Walkforward の結果ファイルの場所を整理

   * `logs/retrain/report_*.json`
   * または WFO集計ファイル
2. Backtestタブに UI追加

   * ラジオボタン

     * Backtest
     * Walkforward
     * Overlay
3. WFO結果読込ロジックを作成
4. グラフに複数シリーズ描画できるよう調整
5. 期間指定と WFO の整合性チェック（期間外データの扱い）
6. UI切替時のリフレッシュ処理

---

# **セッション5：AIタブ（KPI / Feature Importance / SHAP ）の運用版完成**

### 🎯 ゴール

AIタブが **運用の意思決定に十分な情報** を出せる状態に。

### 🔧 サブタスク

1. 決定ログ（`logs/decisions_*.jsonl`）の読込関数を作る
2. recent N trades の

   * 勝率
   * PF
   * 最大DD
   * 連勝/連敗
     を計算するユーティリティを作成
3. モデルの

   * 名前
   * バージョン
   * 検証指標（Logloss, AUC）
     を `model_meta.json` から取得
4. Feature Importance の抽出

   * LightGBM → `.feature_importance()`
   * XGBoost → Booster.get_score()
作業5 → AIタブ × Feature Importance 正式統合
6. SHAPトップ3の簡易可視化（高速版キャッシュ使用）
7. GUIタブに描画
8. モデル切替・再学習後にも正しく反映されるようにする

---

# **セッション6：MT5発注ラッパー（デモ口座）構築**

### 🎯 ゴール

MT5 デモで **実注文 → 約定 → 決済** が最小構成で成功。

### 🔧 サブタスク

1. `core/mt5_client.py`（新規 or 改修）を作成
2. initialize / login / shutdown の実装
3. 成行 BUY/SELL のラッパー（リトライ含む）
4. Close（決済）のラッパー
5. ポジ取得（positions_get）実装
6. ログ出力形式（JSON）を統一
7. `scripts/selftest_order_flow.py` を作成

   * 0.01lot → 発注
   * 約定確認
   * すぐ決済
8. GUIから試験発注する最低限のボタン追加

---

# **セッション7：バックテスト診断AI（v0）の実装**

### 🎯 ゴール

1コマンドで **バックテスト診断レポート** を生成できる。

### 🔧 サブタスク

1. `logs/backtest/.../equity_curve.csv` を読込む解析スクリプト作成
2. 決定ログと突合して

   * トレンド時の成績
   * レンジ時の成績
   * 時間帯別勝率
3. 連敗前後の特徴分析（PF急落ポイントの特定）
4. ATR/ADX と勝率の関係チェック
5. 結果を

   * テキスト
   * HTML
     どちらかで出力
6. “人間が読んで納得できるコメント” をテンプレ＋ルールで生成

---

# **セッション8（任意）：ファイルパス/依存関係の可視化**

### 🎯 ゴール

プロジェクト全体を Agent HQ で **「依存関係地図」化** する。

### 🔧 サブタスク

1. `tree` + Agentチャットで構造を整理
2. データパス / モデルパスの流れを図解させる
3. ToDoリスト２以降の作業の優先度見直し

---

# ⭐ この「細分化版ToDo」をどう使う？

### 1. Agent HQ → セッション作成

例
**[ToDo2-1] データパス統一**
**[ToDo2-2] バックテスト期間指定**
…という名前で作る。

### 2. この細分化版をコピペ

最初のメッセージに貼る。

### 3. 「まずサブタスクの順序を整理して」と指示

Plan Agent がそのセッション専用の設計図を返してくる。

### 4. 作業が終わるたびに

セッションを閉じる or Completed として保存。

---

# 📌 次のステップ

いまこのリストができたので、

👉 **次のメッセージで「どのセッションから取りかかるか」教えてください。**
（例：セッション1からやりたい）

その作業専用の **Agent HQ で使える初期プロンプト** もセットで作ります。
