ToDoリスト Master版（全部入り＋下位版を作りやすい構造）

Master版は「Expert の全部＋開発者用ツール＋制限なし」です。
ここを基準にして、後から EditionGuard でロックをかけて Free〜Expert に落としていきます。

M-A：3％KPIとバックテスト基盤（Masterでも共通の“心臓部”）

M-A1：バックテスト monthly_returns.csv の標準化

すべてのバックテスト結果が
backtests/{profile}/monthly_returns.csv を必ず出すように統一。

CSVのカラム仕様を固定（年月、リターン％、DD％など）。

将来のランキング・AIタブ・診断AIがこの形式を前提に動くようにする。
完了

M-A2：基準ストラテジー（ミチビキ標準プロファイル）の確定

WFO＋ATRベースで「とりあえず3％を狙える」設定を1つ決める。

そのプロファイルを Master/Expert のデフォルトにする。
完了

M-A3：target_monthly_return / max_monthly_dd を使うロット計算ロジック

config.yaml 等に

target_monthly_return（例: 0.03）

max_monthly_dd（例: -0.20）

を持たせ、これを元に lot サイズや SLO（損切りレベル）の目安を出すユーティリティを実装。

後の下位版ではこのロット計算の「パラメータ編集」を制限するだけにする想定。

動作が重くなってきたので軽量化をここで行う。

M-A4：AIタブ “月次3％ダッシュボード” の完成［一部完了］

すでに：

KPI表示、FI、SHAPタブ、SHAP Top3 のウィジェットは実装済み。

Masterで追加すること：

月次リターンのグラフ（折れ線または棒）

今月のリターン vs 目標3％の表示

モデル指標（Logloss/AUC/バージョン）表示

Expert/Master用に「FI全件」「SHAP Top20」を表示可能にすること
（Pro の制限は後で EditionGuard 側でかける前提）

M-A5：バックテスト診断AI（Master/Expert版フル）

v0（時間帯 × 相場タイプ）の診断は ToDo v4 A5 ベース。

Master ではさらに：

DD直前区間の特徴抽出

連勝区間の特徴

勝率が高い相場条件の抽出

損益曲線の異常点検出

簡易の「来週の条件シナリオ」出力

実装先：app.services.diagnosis_service 的なサービス層を想定

M-A6：MT5発注ラッパー＋自己診断スクリプト［APIはほぼ完了・運用フェーズへ］

MT5Client: initialize / login / order_send / close_position / get_positions 系は既に実装・自己テスト済み。

Master側では：

自己診断スクリプト（selftest）のログ形式を本番想定に揃える

決定ログ（logs/decisions_*.jsonl）との連携（いつ・どの戦略で・どれくらいの期待値で発注したか）

M-A7：本番移行チェックリスト（docs/production_checklist.md）

Master開発者用に、

回線・VPS

MT5の設定（自動売買許可、証拠金チェック）

スケジューラの挙動確認

ログローテーション確認

などのチェック項目を文書化。

M-B：フィルタ＆ストラテジー制御（Expert/Masterの「勝率直結部分」）

M-B1：Pro用簡易フィルタとExpert用複合フィルタの共通基盤クラス

1つのフィルタエンジン（例：StrategyFilterEngine）で

時間帯

ATR

ボラ（σ）

トレンド強度

を扱えるように設計。

Pro/Expert/Free等の差は「どのパラメータを設定可能にするか」で後から制限。

M-B2：連敗回避モード

最近のNトレードから連敗数・損失額を見てエントリーを一時停止。

パラメータとして

最大連敗数

再開するための条件（時間・勝ちトレード数）

を持たせる。

下位版では「設定UIを隠す・固定値にする」方向で制限可能なようにする。

M-B3：勝率高いプロファイルの自動切替

monthly_returns / 直近Xトレードなどから「今一番調子の良いプロファイル」を選び、

Master/Expertでは自動切替ON/OFF可能

下位版では手動のみ、などで制御できるようにしておく。

M-B4：ボラティリティ帯ごとの戦略最適化

ボラ指標（ATRや標準偏差）で

低ボラ

中ボラ

高ボラ

の3レジームに分け、それぞれで使うフィルタ or プロファイルを切替できるようにする。

M-C：JobScheduler（Master版フル機能）

仕様書 v4 の JobScheduler 要求を フルで実装 しておき、
下位版は「ジョブ数・種類・編集可否」で絞る方針。

M-C1：JobScheduler 基礎クラス（バックグラウンドスレッド）

既存 ToDo v4 C1 と同じだが、最初から複数ジョブ・連鎖を考慮した設計にする。

jobs は config.scheduler.yaml + ランタイム編集を想定。

last_run_at を内部管理し、重複起動防止。

M-C2：ジョブ型の定義（Master版）

再学習＋Walk-Forward

バックテスト診断レポート生成

ログ圧縮・バックアップ

将来拡張用に「任意コマンド」も許可。

下位版では「使える job_type を制限する」だけで済むようにする。

M-C3：config.scheduler.yaml の採用

edition_min なども含めた形式で設定ファイルを確定。

MasterではGUIからすべて編集可。

下位版では EditionGuard が編集可否を決める形にする。

M-C4：GUI スケジューラ設定タブ（Masterモード）

全ジョブの一覧、次回実行予定時刻、前回実行結果。

ジョブ追加・編集・削除・連鎖設定。

実行履歴ビュー（logs/scheduler.log の簡易ビュー）。

M-C5：旧Windows タスクスケジューラ系スクリプトの整理［あとでやるマークでもOK］

scripts/legacy/ に移動して「開発時の参考用」と明記。

M-D：ランキング機能＋Master専用設定

M-D1：RankingService（クライアント側）の本実装

ToDo v4 B3 の「ローカルモック」を発展させ、

ローカルJSONを「デフォルト」

HTTP API（サーバ実装前提）のためのインターフェースも用意。

M-D2：Master専用ランキング設定UI

サーバURL

APIキー

テスト送信ボタン

ランキングデータの再取得／キャッシュクリアなど

M-D3：ランキングタブ（Master表示モード）

エディション別のタブ or コンボ（Basic/Pro/Expert）。

自分の成績＋過去履歴＋上位ランキング。

マスターでは「モックと本番サーバの切替ボタン」も用意。

M-E：日本語UI・ログ・開発者向けツール

M-E1：日本語UI完全チェック ［一部完了・要総仕上げ］

全タブ・全ダイアログの日本語ラベル統一。

用語（最大ドローダウン、利益率、PF 等）を仕様書 v4 に揃える。

M-E2：ログメッセージの整理

日本語＋簡易英語併記、UTF-8統一。

Master向けにログレベルや出力先（ファイル分割）も設定可能に。

M-E3：Master専用「開発ツール」タブ（任意）

バックテスト一括実行ボタン

モデル比較

SHAPや診断AIのテスト実行

ここは完全に開発者向けなので UI は簡易でもOK。
