T-61 ゴール定義（ログで判定できる “運用開始条件” を固定）

狙い：人間が「今、動いてる/止まってる/危険」をログで即断できる状態に固定する。
成功条件（観測）：

[trade_loop] started mode=... dry_run=... symbol=USDJPY- が必ず出る

停止で [trade_loop] stopped reason=... が必ず出る

以降の全判断が decisions.jsonl / ui_events / ops_history のどれかに残る（“ログに残らない判断は存在しない”） 

michibiki_canonical_vocabulary

【Cursor Agent実行】：ログキーの命名は “公式語彙 + 最小追加”（例：next_action/authorize/evidence/policy_hash）を優先。 

michibiki_canonical_vocabulary

 

michibiki_one_page_architecture

T-62 Controlタブ「取引ON」→ 自動売買ループ開始の“配線”を観測で確定

狙い：「押しても始まらない」をゼロにする（最優先）。
成功条件（観測）：

ボタン押下ごとに必ず [trade_loop] started ... が1回だけ出る（多重起動しない）

停止で必ず [trade_loop] stopped ...

【Cursor Agent実行】：GUI→servicesの呼び出し点を確定し、開始ログを“起動点1箇所”にだけ追加。推測で配線を増やさない（まずgrep）。 

内部仕様書 v5.2

T-63 dry_run / trading_enabled / real接続ガードの“一点化”

狙い：「紙のつもりが実弾」「実のつもりが紙」を撲殺。
成功条件（観測）：

起動時ログに [exec] trading_enabled=... effective_dry_run=... allow_real_account=... が毎回出る

trading_enabled=False のとき 必ず effective_dry_run=True になり、発注経路に進まない

【Cursor Agent実行】：EditionGuard 等の既存ガードを優先し、実効dry_run決定点を1点に固定。 

内部仕様書 v5.2

T-64 発注の最終一点（order_send相当）到達を“観測で確定”

狙い：戦略が正しくても注文が出ない問題を潰す。
成功条件（観測）：

シグナル成立 → [ORDER] prepared ... が出る

dry_run=True → [ORDER] skipped reason=dry_run が出る

dry_run=False → order_send result=OK|FAIL reason=... が出る（失敗理由も）

【Cursor Agent実行】：app/core/mt5_client.py / app/services/trade_service.py の既存APIを優先し、“prepared”ログは1箇所だけ。 

api_catalog

T-65 事前診断（開始時点で “取引可能” が確定してから回す）

狙い：注文出してから「口座ダメでした」を無くす。
成功条件（観測）：

started直後に1回だけ [mt5] connected=... trade_allowed=... account=... が出る

NGなら 即BLOCK（送信処理へ進まない）

【Cursor Agent実行】：T-60で確立した services 経路を再利用（GUI直MT5禁止）。 

内部仕様書 v5.2

T-66 建玉状態の整合（open_position嘘・二重エントリー防止）

狙い：実運用で一番死ぬ“状態不整合”を潰す。
成功条件（観測）：

「ポジ無しなのに open=True」で固まらない（定期reconcileで復帰）

「ポジあるのに open=False」で二重発注しない

denied時に [guard] denied reason=... が出る

【Cursor Agent実行】：既存の整合機構（例：TradeService._periodic_reconcile / reconcile_positions）を優先して接続。新規関数は最小限。 

api_catalog

T-67 決済・損益記録の一本化（exit_reason / profit_jpy が必ず残る）

狙い：“勝った/負けた/なぜ決済した”が監査可能になる。
成功条件（観測）：

決済ごとに profit_jpy が ui_events / ops_history / decisions のどれかに残る

exit_reason が必ず残る（TP/SL/timeout等）

【Cursor Agent実行】：record_trade_result(...) 系の既存契約を壊さず、ログ出力と保存先を一本化。 

api_catalog

 

michibiki_canonical_vocabulary

T-68 “守りだけ自動”の安全運用（automation_level=1 相当）

狙い：攻め（エントリー）を人間承認に残しつつ、守り（停止/縮小/強制EXIT）だけは自動で効く状態へ。
成功条件（観測）：

連敗/DD等で 自動停止 or サイズダウン が発動し、理由が残る（authorize/evidence）

解除は人間操作が必要（勝手に復帰しない）

【Cursor Agent実行】：CircuitBreaker/Guardを優先利用し、“守りの自動”だけ許可する状態にする。 

api_catalog

 

michibiki_canonical_vocabulary

T-69 実運用ミニ・プロトコル（運用手順を固定：コード変更なし）

狙い：回しながら壊さない。
成功条件（運用）：

最小ロット、時間帯限定、監視あり

“止めたい時に確実に止まる”手順が確定（GUI停止→プロセス停止の順など）

ログと履歴が残り、再現できる

（この段は運用ルールの確定。ロジック追加はしない） 

自動売買ToDoリスト